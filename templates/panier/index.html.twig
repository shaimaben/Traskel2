{% extends 'basePanier/basePanier.html.twig' %}

{% block title %}Panier index{% endblock %}

{% block body %}
    <h1>Panier index</h1>

<div class="card">
    <div class="card-header bg-dark text-white">
        <h5 class="card-title">Shopping Cart</h5>
    </div>
    <div class="card-body">
        <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Produit ID</th>
                <th>Image du Produit</th>
                <th>Nom du Produit</th>
                <th>Prix du Produit</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% set total_price = 0 %}
            {% for produit in produits %}
                <tr>
                    <td>{{ produit.id }}</td>
                    <td>
                            <img src="{{ asset('uploads/' ~ produit.photoProd) }}" class="img-fluid" alt="Product Image" style="width: 100px; height: 80px;">
                        </td>
                    <td>{{ produit.nomProd }}</td>
                    <td>{{ produit.prixProd }}</td>
                    <td>
                        <a href="{{ path('app_delete_produit_from_panier', {'produit_id': produit.id}) }}" class="btn btn-danger">Delete</a>
                    </td>
                </tr>
                {% set total_price = total_price + produit.prixProd %}
            {% endfor %}
            {% if produits|length == 0 %}
                <tr>
                    <td colspan="5">No records found</td>
                </tr>
            {% endif %}
        </tbody>
        </table>
    </div>
    <div class="card-footer">
        <p class="text-muted">Thank you for shopping with us!</p>
    </div>
</div>

    {% if produits|length > 0 %}
        <div style="text-align: center; font-size: 2em; font-weight: bold; margin-top: 20px;">
             Total Price: <span style="color: #114727;">{{ total_price|number_format(2, '.', ',') }} </span>Dinar <br><br>
             Nombre des Produits: <span style="color: #114727;">{{ produits|length }}</span>

        </div>
    {% endif %}

    <a href="{{ path('app_produits_index') }}" class="btn btn-secondary">Retour au produits</a>
    <!-- <a href="{{ path('app_panier_new') }}">Create new</a> -->
    <br>


    <div style="margin-bottom: 20px;">
        <label for="adresse" style="display: block; margin-bottom: 10px; font-weight: bold;">Votre Adresse:</label>
        <input type="text" id="adresse" name="adresse" style="width: 70%; padding: 8px; box-sizing: border-box;" required>
        <span id="adresse-error" style="color: red; display: none;">Veuillez entrer votre adresse.</span>
    </div>

    <div style="margin-bottom: 20px;">
        <label for="delais_Cmd" style="display: block; margin-bottom: 10px; font-weight: bold;">Détails de la Commande:</label>
        <input type="text" id="delais_Cmd" name="delais_Cmd" style="width: 70%; padding: 8px; box-sizing: border-box;" required>
        <span id="delais-Cmd-error" style="color: red; display: none;">Veuillez entrer les détails de la commande.</span>
    </div>

    <a id="commande-link" href="{{ path('app_commande_new', {'total_price': total_price}) }}" class="btn btn-danger"><strong>Passer la Commande</strong></a>


<br><br>
<script>
    function updateCommandeLink() {
        var adresseValue = document.getElementById('adresse').value;
        var delaisCmdValue = document.getElementById('delais_Cmd').value;
        var total_price = {{ total_price }}; // assuming total_price is defined in the template
        var commandeLink = document.getElementById('commande-link');
        commandeLink.href = '{{ path('app_commande_new', {'total_price': total_price}) }}&adresse=' + encodeURIComponent(adresseValue) + '&delais_Cmd=' + encodeURIComponent(delaisCmdValue);
    }

    document.getElementById('adresse').addEventListener('input', updateCommandeLink);
    document.getElementById('delais_Cmd').addEventListener('input', updateCommandeLink);

    function updateCommandeLink() {
            var adresseValue = document.getElementById('adresse').value;
            var delaisCmdValue = document.getElementById('delais_Cmd').value;
            var total_price = {{ total_price }}; // assuming total_price is defined in the template
            var commandeLink = document.getElementById('commande-link');
            
            // Check if the fields are not empty
            if (adresseValue.trim() !== '' && delaisCmdValue.trim() !== '') {
                // If not empty, update the link
                commandeLink.href = '{{ path('app_commande_new', {'total_price': total_price}) }}&adresse=' + encodeURIComponent(adresseValue) + '&delais_Cmd=' + encodeURIComponent(delaisCmdValue);
            } else {
                // If empty, disable the link or display an error message
                commandeLink.removeAttribute('href'); // This will disable the link
                // Alternatively, you can display an error message
                // Example: alert("Veuillez remplir tous les champs.");
                document.getElementById('adresse-error').style.display = adresseValue.trim() === '' ? 'inline' : 'none';
                document.getElementById('delais-Cmd-error').style.display = delaisCmdValue.trim() === '' ? 'inline' : 'none';
            }
        }

        document.getElementById('adresse').addEventListener('input', function () {
            document.getElementById('adresse-error').style.display = 'none';
            updateCommandeLink();
        });

        document.getElementById('delais_Cmd').addEventListener('input', function () {
            document.getElementById('delais-Cmd-error').style.display = 'none';
            updateCommandeLink();
        });
</script>

<style>
        .error {
            border: 1px solid red;
        }
.card {
    width: 80%;
    margin: 20px auto;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.card-header, .card-footer {
    background-color: #e2eee6;
}

.card-title, .text-muted {
    color: #fff;
}

.card-footer {
    text-align: right;
}

.table {
    margin-bottom: 0;
}

.table th, .table td {
    text-align: center;
}

.table thead {
    background-color: #343a40;
    color: #fff;
}

.table th, .table td {
    border: 1px solid #dee2e6;
}

.table th {
    background-color: #007BFF;
    color: #fff;
}

.table-striped tbody tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}

.btn-danger {
    background-color: #dc3545;
    border-color: #dc3545;
    color: #fff;
}

.btn-danger:hover {
    background-color: #bd2130;
    border-color: #bd2130;
}

</style>
{% endblock %}
